<<<<<<< HEAD
function showField(){$("#mainFieldSearch").removeClass("col-lg-9").addClass("col-lg-5")}!function(e){String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};var n={D_SEARCH_KEYWORD_IDENTIFIER:"jobs-in-bangalore",D_LOCALITY_IDENTIFIER:"near-",D_LOCATION_ALL_BANGALORE:{}},o={allJobRole:[],allLocation:[],currentURL:null,suggestion:null,bMethods:{init:function(){void 0,o.render.renderTextSearch(),o.render.renderLocation()},getAllJobRole:function(){return 0==o.allJobRole.length?e.ajax({type:"POST",url:"/getAllJobs"}):new Promise(function(e,n){e(null)})},getAllLocation:function(){return 0==o.allLocation.length?e.ajax({type:"POST",url:"/getAllLocality"}):new Promise(function(e,n){e(null)})},getAllLanguage:function(){return 0==o.allLanguage.length?e.ajax({type:"POST",url:"/getAllLanguage"}):new Promise(function(e,n){e(null)})}},render:{renderJobRole:function(){new Promise(function(e,n){o.bMethods.getAllJobRole().then(function(n){null!=n&&n.forEach(function(e){var n=e.jobRoleId,t=e.jobName,a={};a.id=n,a.name=t,o.allJobRole.push(a)}),e()},function(e,o,t){n(t)})})},renderLocation:function(t){if(null!=t)e("#searchLocation").tokenize({displayDropdownOnFocus:!0,placeholder:"Location",newElements:!0,nbDropdownElements:1e3,maxElements:1}).tokenRemove(e("#searchLocation").val()[0]).tokenAdd(t.localityId,t.localityName);else if(0==e("#searchLocation option[value='1']").length){var a=new Promise(function(e,n){o.bMethods.getAllLocation().then(function(n){null!=n&&n.forEach(function(e){o.allLocation.push(e)}),e()},function(e,o,t){n(t)})});a.then(function(){n.D_LOCATION_ALL_BANGALORE={id:"0",name:"All Bangalore"};var t=e('<option value="0"></option>').text("All Bangalore");e("#searchLocation").append(t),o.allLocationArray=[],o.allLocation.forEach(function(n){var a=n.localityId,l=n.localityName;t=e("<option value="+a+"></option>").text(l),e("#searchLocation").append(t);var i={};i.id=a,i.name=l,o.allLocationArray.push(i)}),void 0,e("#searchLocation").tokenize({displayDropdownOnFocus:!0,placeholder:"Location",newElements:!0,nbDropdownElements:1e3,maxElements:1}),e("#searchLocation").tokenize().tokenRemove("0"),e("#searchLocation").tokenize().tokenAdd(n.D_LOCATION_ALL_BANGALORE.id,n.D_LOCATION_ALL_BANGALORE.name)}).catch(function(e){void 0})}},renderTextSearch:function(){var n=e("#searchText");n.val().split(",");null==o.suggestion&&(o.suggestion=new Awesomplete("input[data-multiple]",{minChars:1,autoFirst:!0,filter:function(e,n){return Awesomplete.FILTER_CONTAINS(e,n.match(/[^,]*$/)[0])},replace:function(e){var n=this.input.value.match(/^.+,\s*|/)[0];this.input.value=n+e+", "}})),e(".awesomplete").css("width","100%"),null==n.val()||n.val().length<3||e.ajax({url:"/ss/?key="+n.val(),type:"GET",dataType:"json"}).success(function(t){var a=[];e.each(t,function(e,o){n.val().toLowerCase().indexOf(o.toLowerCase()+",")>=0||a.push(o)}),o.suggestion.list=a,null!=o.suggestion.list&&0==o.suggestion.list.length})}},do:{redirectToSearchPage:function(){window.location="/s/"+o.currentURL},fillSearchTextBoxWithKeywords:function(e){var n=e.join(" ")+", ";document.getElementById("searchText").value=n.toTitleCase()},prepNmodifyURL:function(){return o.do.modifyURL(o.do.prepareURL())},modifyURL:function(e){return window.history.pushState("object or string","Title","/s/"+e),"/s/"+e},prepareURL:function(){var e=document.getElementById("searchText").value;null==e&&""==e.trim()||(e+="-'"),e+=n.D_SEARCH_KEYWORD_IDENTIFIER,e=e.replace(/[^a-z0-9]+/gi,"-"),e=e.replace(/^(-)+/,"");var o=document.getElementById("searchLocation"),t=o.options[o.selectedIndex];return 0!=o.value&&null!=t&&(e+="_"+n.D_LOCALITY_IDENTIFIER+t.innerHTML.replace(/\s+/g,"-")),(e+"/").toLowerCase()}},run:{validateWorkShift:function(e){return null==e?"":e.timeShiftName?e.timeShiftName:void 0},urlChangeDetector:function(){window.history&&window.history.pushState&&e(window).on("popstate",function(){location.reload()})},basicReset:function(){o.page=1,o.isPaginationEnabled=!1,null==e("#searchLocation").val()&&e("#searchLocation").tokenize({displayDropdownOnFocus:!0,placeholder:"Location",nbDropdownElements:1e3,maxElements:1}).tokenAdd(n.D_LOCATION_ALL_BANGALORE.id,n.D_LOCATION_ALL_BANGALORE.name)}}};document.getElementById("searchBtn").addEventListener("click",function(){o.page=1,o.currentURL=o.do.prepareURL(),o.do.redirectToSearchPage()}),o.bMethods.init(),e("#searchText").on("keyup",function(e){e.keyCode>=32&&e.keyCode<=47||13==e.keyCode||o.render.renderTextSearch()})}(jQuery);
=======
/*
 * truSearch: TruJobs Search mini plugin
 * Version 1.0.0
 *
 * Copyright (c) 2016 TruJobs.in (http://trujobs.in)
 *
 * Created by zero on 30/12/16.
 *
 */

(function($) {

    String.prototype.capitalizeFirstLetter = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
    };

    String.prototype.toTitleCase = function() {
        return this.replace(/\w\S*/g, function(txt) {
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        });
    };
    var DEFAULT_VALUES = {
        D_SEARCH_KEYWORD_IDENTIFIER: "jobs-in-bangalore",
        D_LOCALITY_IDENTIFIER: "near-",
        D_LOCATION_ALL_BANGALORE: {}
    };
    var app = {
        allJobRole: [],
        allLocation: [],
        currentURL: null,
        suggestion: null,

        // basic getter/setter types method
        bMethods: {
            init: function() {
                console.log("init");
                app.render.renderTextSearch();
                app.render.renderLocation();

            },
            getAllJobRole: function() {
                //ajax call and save data to allJobRole
                if (app.allJobRole.length == 0) {
                    return $.ajax({
                        type: 'POST',
                        url: '/getAllJobs'
                    });
                } else {
                    // new promise says its already there
                    return new Promise(function(resolve, reject) {
                        resolve(null);
                    });
                }
            },
            getAllLocation: function() {
                //ajax call || its a promise
                if (app.allLocation.length == 0) {
                    return $.ajax({
                        type: 'POST',
                        url: '/getAllLocality'
                    });
                } else {
                    // new promise says its already there
                    return new Promise(function(resolve, reject) {
                        resolve(null);
                    });
                }
            },
            getAllLanguage: function() {
                //ajax call and save data to allExperience
                if (app.allLanguage.length == 0) {
                    return $.ajax({
                        type: 'POST',
                        url: '/getAllLanguage'
                    });
                } else {
                    // new promise says its already there
                    return new Promise(function(resolve, reject) {
                        resolve(null);
                    });
                }
            }
        },
        // basic ui rendering methods
        render: {
            renderJobRole: function() {
                var promise = new Promise(function(resolve, reject) {
                    app.bMethods.getAllJobRole().then(
                        function(returnedData) {
                            if (returnedData != null) {
                                returnedData.forEach(function(jobRole) {
                                    var id = jobRole.jobRoleId;
                                    var name = jobRole.jobName;
                                    var item = {};
                                    item["id"] = id;
                                    item["name"] = name;
                                    app.allJobRole.push(item);
                                });
                            }
                            resolve();
                        },
                        function(xhr, state, error) {
                            reject(error);
                        }
                    );
                });

            },
            renderLocation: function(locality) {
                if (locality != null) {
                    $('#searchLocation').tokenize({
                        displayDropdownOnFocus: true,
                        placeholder: "Location",
                        newElements: true,
                        nbDropdownElements: 1000,
                        maxElements: 1
                    }).tokenRemove($('#searchLocation').val()[0]).tokenAdd(locality.localityId, locality.localityName);
                }
                // this if check prevents static token suggestion from being duplicated
                else if ($("#searchLocation option[value='1']").length == 0) {
                    var promise = new Promise(function(resolve, reject) {
                        app.bMethods.getAllLocation().then(
                            function(returnedData) {
                                if (returnedData != null) {
                                    returnedData.forEach(function(locality) {
                                        app.allLocation.push(locality);
                                    });
                                }
                                resolve();
                            },
                            function(xhr, state, error) {
                                reject(error);
                            }
                        );
                    });

                    promise.then(function() {
                        DEFAULT_VALUES.D_LOCATION_ALL_BANGALORE = {
                            id: "0",
                            name: "All Bangalore"
                        };
                        var option = $('<option value="0"></option>').text("All Bangalore");
                        $('#searchLocation').append(option);

                        app.allLocationArray = [];
                        app.allLocation.forEach(function(locality) {
                            var id = locality.localityId;
                            var name = locality.localityName;
                            option = $('<option value=' + id + '></option>').text(name);
                            $('#searchLocation').append(option);

                            var item = {};
                            item["id"] = id;
                            item["name"] = name;
                            app.allLocationArray.push(item);
                        });

                        console.log("app.allLocation size: " + app.allLocation.length);
                        $('#searchLocation').tokenize({
                            displayDropdownOnFocus: true,
                            placeholder: "Location",
                            newElements: true,
                            nbDropdownElements: 1000,
                            maxElements: 1
                        });

                        $('#searchLocation').tokenize().tokenRemove('0');
                        $('#searchLocation').tokenize().tokenAdd(DEFAULT_VALUES.D_LOCATION_ALL_BANGALORE.id, DEFAULT_VALUES.D_LOCATION_ALL_BANGALORE.name);

                    }).catch(function(fromReject) {
                        console.log(fromReject);
                    });
                }
            },
            // render filter
            renderTextSearch: function() {
                var input = $("#searchText");
                var numberOfKeywords = input.val().split(",");

                if (app.suggestion == null) {
                    app.suggestion = new Awesomplete('input[data-multiple]', {
                        minChars: 1,
                        autoFirst: true,
                        filter: function(text, input) {
                            return Awesomplete.FILTER_CONTAINS(text, input.match(/[^,]*$/)[0]);
                        },

                        replace: function(text) {
                            var before = this.input.value.match(/^.+,\s*|/)[0];
                            this.input.value = before + text + ", ";
                        }
                    });
                }
                $('.awesomplete').css('width', '100%');

                if ((input.val() == null || input.val().length < 3)) {
                    return;
                }

                $.ajax({
                    url: '/ss/?key=' + input.val(),
                    type: 'GET',
                    dataType: 'json'
                }).success(function(data) {
                    var list = [];
                    $.each(data, function(key, value) {
                        if (!(input.val().toLowerCase().indexOf(value.toLowerCase() + ",") >= 0)) {
                            list.push(value);
                        }
                    });
                    app.suggestion.list = list;
                    if (app.suggestion.list != null && app.suggestion.list.length == 0) {
                        // when no suggestions are returned. do something here...
                    }
                });
            }
        },
        // action perform methods
        do: {
            redirectToSearchPage: function() {

                // redirect with the formed url
                window.location = "/s/" + app.currentURL;
            },
            fillSearchTextBoxWithKeywords: function(keywordList) {
                var searchBoxText = keywordList.join(" ") + ", ";
                document.getElementById("searchText").value = searchBoxText.toTitleCase();
            },
            prepNmodifyURL: function() {
                return app.do.modifyURL(app.do.prepareURL());
            },
            modifyURL: function(url) {
                // TODO ideally this should change after the result is returned
                window.history.pushState("object or string", "Title", "/s/" + url);
                return "/s/" + url;
            },
            prepareURL: function() {
                var _searchStr = document.getElementById("searchText").value;

                if (_searchStr != null || _searchStr.trim() != "") {
                    _searchStr += "-'";
                }
                // forced in-bangalore
                _searchStr += DEFAULT_VALUES.D_SEARCH_KEYWORD_IDENTIFIER;

                // replace all  all non-alphanumeric characters
                _searchStr = _searchStr.replace(/[^a-z0-9]+/gi, '-');

                // replace first occurance of -
                _searchStr = _searchStr.replace(/^(-)+/, "");

                var _location = document.getElementById("searchLocation");
                var _text = _location.options[_location.selectedIndex];
                if (_location.value != 0 && _text != null) {
                    _searchStr += "_" + DEFAULT_VALUES.D_LOCALITY_IDENTIFIER + _text.innerHTML.replace(/\s+/g, '-');
                }

                return (_searchStr + "/").toLowerCase();
            }
        },
        // action validator methods
        run: {
            validateWorkShift: function(jobPostShift) {
                if (jobPostShift == null) {
                    return "";
                } else if (jobPostShift.timeShiftName) {
                    return jobPostShift.timeShiftName;
                }
            },
            urlChangeDetector: function() {
                if (window.history && window.history.pushState) {

                    $(window).on('popstate', function() {
                        location.reload();
                    });

                }
            },
            basicReset: function() {
                app.page = 1;
                app.isPaginationEnabled = false;


                if ($('#searchLocation').val() == null) {
                    $('#searchLocation').tokenize({
                        displayDropdownOnFocus: true,
                        placeholder: "Location",
                        nbDropdownElements: 1000,
                        maxElements: 1
                    }).tokenAdd(DEFAULT_VALUES.D_LOCATION_ALL_BANGALORE.id,
                        DEFAULT_VALUES.D_LOCATION_ALL_BANGALORE.name);
                }
            }
        }
    };
    // search click listener
    document.getElementById("searchBtn").addEventListener("click", function() {
        app.page = 1; // reset page to 1 for new search
        app.currentURL = app.do.prepareURL();

        app.do.redirectToSearchPage();
    });

    // control flow
    app.bMethods.init();

    // this detect the typing even on the search bar
    $('#searchText').on('keyup', function(event) {
        if (!(event.keyCode >= 32 && event.keyCode <= 47) && (event.keyCode != 13)) {
            app.render.renderTextSearch();
            // trigger suggestion only when typing alpha numeric is happening
        }
    });


}(jQuery));


function showField() {
    $('#mainFieldSearch').removeClass("col-lg-9").addClass("col-lg-5");
}
>>>>>>> rmp-employee
